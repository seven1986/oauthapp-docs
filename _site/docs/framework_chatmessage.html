<h1 id="消息">消息</h1>

<h3 id="消息表集合">消息表集合</h3>

<p>oauthapp.messageTables</p>

<p>获取当前应用中所有的消息表名称</p>

<p>???+ note “提示”
    消息表是用来存储不同类型消息的，例如：系统通知、私信消息、好友申请等等。这个方法可以用于列举所有的消息表，以便其他方法可以对指定的表进行增删改查等操作。</p>

<p>=== “方法”</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```JavaScript linenums="1"
oauthapp.messageTables().then(function(res){
    console.log(res);
});
```
</code></pre></div></div>

<p>=== “示例”</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```HTML
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;messageTables&lt;/title&gt;
    &lt;!-- data-appid 属性替换为你的 OAuthApp 应用的 ID --&gt;
    &lt;script id="appcore" src="https://www.oauthapp.com/lib/sdk/oauthapp.1.9.8.js" data-appid="2"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div&gt;结果：&lt;span id="result"&gt;&lt;/span&gt;&lt;/div&gt;
    &lt;script&gt;
        oauthapp.allReady().then(function () {
            oauthapp.messageTables().then(function (res) {
                $('#result').text(JSON.stringify(res));
            })
        });
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
```
</code></pre></div></div>

<p><a href="https://web.oauthapp.com/4/examples/apidemo/messageTables.html">演示</a>{ .md-button }    <a href="https://docs.oauthapp.com/coding_sdk_chatmessage_messagetables/">教程</a>{ .md-button }</p>

<h3 id="创建消息表">创建消息表</h3>

<p>oauthapp.messageCreate</p>

<p>=== “方法”</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```JavaScript linenums="1"
oauthapp.messageCreate(table).then(function(res){
    console.log(res);
});
```
</code></pre></div></div>

<p>=== “示例”</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```HTML linenums="1"
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;创建消息表&lt;/title&gt;
    &lt;script id="appcore" src="https://www.oauthapp.com/lib/sdk/oauthapp.1.9.8.js" data-appid="2"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div&gt;
        &lt;h3&gt;创建消息表&lt;/h3&gt;
        &lt;p&gt;table：&lt;input type="text" id="table" /&gt;&lt;/p&gt;
        &lt;p&gt;
            &lt;button type="button" id="actionButton"&gt;提交&lt;/button&gt;
        &lt;/p&gt;
    &lt;/div&gt;
    &lt;div id="result"&gt;&lt;/div&gt;
    &lt;script&gt;
        oauthapp.ready().then(function () {
            $('#actionButton').click(function () {
                var table = $('#table').val();
                oauthapp.messageCreate(table).then(function (res) {
                    $('#result').text(JSON.stringify(res));
                });
            });
        });
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
```
</code></pre></div></div>

<p>=== “参数说明”</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>| 参数  | 说明 |  |
| ----------- | ----------- | ----------- |
| table | 表名称 |  |
</code></pre></div></div>

<p><a href="https://web.oauthapp.com/4/examples/apidemo/messageCreate.html">演示</a>{ .md-button }<br />
<!-- [教程](){ .md-button } --></p>

<h3 id="消息分类">消息分类</h3>

<p>oauthapp.messageCategories</p>

<p>获取指定消息表中的所有消息分类</p>

<p>???+ note “提示”
    消息分类是对消息进行分组管理的方式之一，可以将相关主题的消息放在同一分类下，方便用户进行查看和管理。
    该方法返回一个 Promise 对象，当获取成功时，Promise 对象的状态为 resolved，返回一个数组，包含所有分类名称。如果获取失败，Promise 对象的状态为 rejected，返回一个错误对象。</p>

<p>=== “方法”</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```JavaScript linenums="1"
oauthapp.messageCategories(table).then(function(res){
    console.log(res);
});
```
</code></pre></div></div>

<p>=== “示例”</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```HTML
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;messageCategories&lt;/title&gt;
    &lt;!-- data-appid 属性替换为你的 OAuthApp 应用的 ID --&gt;
    &lt;script id="appcore" src="https://www.oauthapp.com/lib/sdk/oauthapp.1.9.8.js" data-appid="2"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;p&gt;&lt;input type="text" id="table" placeholder="table" /&gt;&lt;/p&gt;
  &lt;p&gt;
    &lt;button type="button" onclick="queryData()"&gt;查询&lt;/button&gt;
  &lt;/p&gt;
    &lt;div&gt;结果：&lt;span id="result"&gt;&lt;/span&gt;&lt;/div&gt;
    &lt;script&gt;
      function queryData(){
        var table = $('#table').val();
          oauthapp.messageCategories(table).then(function (res) {
                $('#result').text(JSON.stringify(res));
            })
      }
        oauthapp.allReady().then(function () {
        });
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
```
</code></pre></div></div>

<p>=== “参数说明”</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>| 参数  | 说明 |  |
| ----------- | ----------- | ----------- |
| table | 表名称  |  |
</code></pre></div></div>

<p><a href="https://web.oauthapp.com/4/examples/apidemo/messageCategories.html">演示</a>{ .md-button }    <a href="https://docs.oauthapp.com/coding_sdk_chatmessage_messagecategories/">教程</a>{ .md-button }</p>

<h3 id="消息列表">消息列表</h3>

<p>oauthapp.messages</p>

<p>获取指定消息表中的消息列表。</p>

<p>???+ note “提示”
    你可以选择按照消息组、标签、关键词搜索、以及分页的方式来获取消息列表。
    返回一个 Promise 对象，解析结果为一个消息数组，其中每个元素都包含消息的详细信息，例如消息 ID、分类、标签、内容、备注、创建时间等。</p>

<p>=== “方法”</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```JavaScript linenums="1"
oauthapp.messages(table,category,tag, search, take,skip).then(function(res){
    console.log(res);
});
```
</code></pre></div></div>

<p>=== “示例”</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```HTML linenums="1"
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;messages&lt;/title&gt;
    &lt;!-- data-appid 属性替换为你的 OAuthApp 应用的 ID --&gt;
    &lt;script id="appcore" src="https://www.oauthapp.com/lib/sdk/oauthapp.1.9.8.js" data-appid="2"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div&gt;
        &lt;input type="text" id="table" placeholder="聊天表名称" /&gt;
        &lt;input type="text" id="category" placeholder="聊天组" /&gt;
        &lt;input type="text" id="search" placeholder='查询关键字' /&gt;
        &lt;input type="text" id="tag" placeholder='消息标签' /&gt;
        &lt;input type="number" value="10" id="take" placeholder='拉取条数' /&gt;
        &lt;input type="number" value="0" id="skip" placeholder='跳过条数' /&gt;
        &lt;button type="button" id="queryButton"&gt;查询&lt;/button&gt;
    &lt;/div&gt;
    &lt;div&gt;结果：&lt;span id="result"&gt;&lt;/span&gt;&lt;/div&gt;
    &lt;script&gt;
        oauthapp.allReady().then(function () {
            document.getElementById('queryButton').onclick = function () {
                var table = $('#table').val();
                var category = $('#category').val();
                var search = $('#search').val();
                var tag = $('#tag').val();
                var take = $('#take').val();
                var skip = $('#skip').val();
                oauthapp.messages(table, category, tag,search, take, skip).then(function (res) {
                    $('#result').text(JSON.stringify(res));
                })
            }
        });
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
```
</code></pre></div></div>

<p>=== “参数说明”</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>| 参数  | 说明 |  |
| ----------- | ----------- | ----------- |
| table | 表名称  |  |
| category | 消息组  |  |
| tag | 消息标签  |  |
| search | 查询关键词  |  |
| take | 拉取条数 | 10 |
| skip | 跳过条数 | 0 |
</code></pre></div></div>

<p><a href="https://web.oauthapp.com/4/examples/apidemo/messages.html">演示</a>{ .md-button } <a href="https://docs.oauthapp.com/coding_sdk_chatmessage_messages/">教程</a>{ .md-button }</p>

<h3 id="发送消息">发送消息</h3>

<p>oauthapp.messagePost</p>

<p>向指定消息表中添加一条新的消息。需要提供消息的分类、标签、内容等相关信息。</p>

<p>???+ note “提示”
    该方法返回一个 Promise 对象，如果消息发布成功，Promise 对象会 resolve，返回新发布的消息的 ID；否则会 reject，返回错误信息。</p>

<p>=== “方法”</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```JavaScript linenums="1"
oauthapp.messagePost(table,msgData).then(function(res){
    console.log(res);
});
```
</code></pre></div></div>

<p>=== “示例”</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```HTML linenums="1"
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;messagePost&lt;/title&gt;
    &lt;!-- data-appid 属性替换为你的 OAuthApp 应用的 ID --&gt;
    &lt;script id="appcore" src="https://www.oauthapp.com/lib/sdk/oauthapp.1.9.8.js" data-appid="2"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
       &lt;p&gt;&lt;input type="text" id="table" placeholder="table" /&gt;&lt;/p&gt;
       &lt;p&gt;&lt;input type="text" id="category" placeholder="category" /&gt;&lt;/p&gt;
       &lt;p&gt;&lt;input type="text" id="tags" placeholder="tags" /&gt;&lt;/p&gt;
       &lt;p&gt;&lt;input type="text" id="content" placeholder="content" /&gt;&lt;/p&gt;
       &lt;p&gt;&lt;input type="text" id="remark" placeholder="remark" /&gt;&lt;/p&gt;
       &lt;p&gt;&lt;input type="text" id="unionID" placeholder="unionID" /&gt;&lt;/p&gt;
       &lt;p&gt;&lt;input type="text" id="nickName" placeholder="nickName" /&gt;&lt;/p&gt;
       &lt;p&gt;&lt;input type="text" id="avatar" placeholder="avatar" /&gt;&lt;/p&gt;
       &lt;p&gt;&lt;input type="text" id="platform" placeholder="platform" /&gt;&lt;/p&gt;
       &lt;p&gt;&lt;input type="text" id="messageType" placeholder="TEXT/FILE/IMAGE" value="TEXT" /&gt;&lt;/p&gt;
       &lt;p&gt;&lt;input type="number" value="1" id="showIndex" placeholder="showIndex" /&gt;&lt;/p&gt;
       &lt;p&gt;&lt;button type="button" id="addButton"&gt;提交&lt;/button&gt;&lt;/p&gt;
    &lt;div&gt;结果：&lt;span id="result"&gt;&lt;/span&gt;&lt;/div&gt;
    &lt;script&gt;
        oauthapp.allReady().then(function () {
            document.getElementById('addButton').onclick = function () 
            {
                var table = $('#table').val();
                var category = $('#category').val();
                var tags = $('#tags').val();
                var content = $('#content').val();
                var remark = $('#remark').val();
                var unionID = $('#unionID').val()||oauthapp.appUser.unionID;
                var nickName = $('#nickName').val()||oauthapp.appUser.nickName;
                var avatar = $('#avatar').val()||oauthapp.appUser.avatar;
                var platform = $('#platform').val() ||oauthapp.appUser.platform;
                var messageType = $('#messageType').val();
                var showIndex = $('#showIndex').val();

                oauthapp.messagePost(table,{
                    category,
                    tags,
                    content,
                    remark,
                    unionID,
                    nickName,
                    avatar,
                    platform,
                    messageType,
                    showIndex
                }).then(function (res) {
                    $('#result').text(JSON.stringify(res));
                });
            }
        });
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
```
</code></pre></div></div>

<p>=== “参数说明”</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>| 参数  | 说明 |  |
| ----------- | ----------- | ----------- |
| table | 消息所在的表名称。  |  |
| msgData.category | 消息分类。  |  |
| msgData.tags | 消息标签，用英文逗号分隔。  |  |
| msgData.content | 消息内容。  |  |
| msgData.remark | 消息备注。 |  |
| msgData.unionId | 第三方平台的用户ID。 | 可以使用 oauthapp.settings.fingerIdentity 或者自定义 |
| msgData.nickName | 用户昵称 |  |
| msgData.avatar | 用户头像 |  |
| msgData.platform | 第三方平台标识字符串  | 可以是 web、weibo、weixin、qq 或者自定义。 |
| msgData.messageType | 消息类型  | 可以是 TEXT、IMAGE、FILE 或者自定义 |
| msgData.showIndex | 排序  |  |
</code></pre></div></div>

<p><a href="https://web.oauthapp.com/4/examples/apidemo/messagePost.html">演示</a>{ .md-button }  <a href="https://docs.oauthapp.com/coding_sdk_chatmessage_messagepost/">教程</a>{ .md-button }</p>

<h3 id="修改消息">修改消息</h3>

<p>oauthapp.messagePut</p>

<p>修改指定消息表中的一条消息。需要提供需要修改的消息的ID，以及修改后的分类、标签、内容等相关信息。</p>

<p>???+ note “提示”
    修改成功时返回一个 JSON 对象，其中包含一个字段 success 表示是否修改成功，如果修改失败，还会包含一个 error 字段表示错误信息。</p>

<p>=== “方法”</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```JavaScript linenums="1"
oauthapp.messagePut(table,id,msgData).then(function(res){
    console.log(res);
});
```
</code></pre></div></div>

<p>=== “示例”</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```HTML linenums="1"
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;messagePut&lt;/title&gt;
    &lt;!-- data-appid 属性替换为你的 OAuthApp 应用的 ID --&gt;
    &lt;script id="appcore" src="https://www.oauthapp.com/lib/sdk/oauthapp.1.9.8.js" data-appid="2"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
       &lt;p&gt;&lt;input type="text" id="table" placeholder="table" /&gt;&lt;/p&gt;
       &lt;p&gt;&lt;input type="text" id="dataId" placeholder="dataId" /&gt;&lt;/p&gt;
       &lt;p&gt;&lt;input type="text" id="category" placeholder="category" /&gt;&lt;/p&gt;
       &lt;p&gt;&lt;input type="text" id="tags" placeholder="tags" /&gt;&lt;/p&gt;
       &lt;p&gt;&lt;input type="text" id="content" placeholder="content" /&gt;&lt;/p&gt;
       &lt;p&gt;&lt;input type="text" id="remark" placeholder="remark" /&gt;&lt;/p&gt;
       &lt;p&gt;&lt;input type="text" id="unionID" placeholder="unionID" /&gt;&lt;/p&gt;
       &lt;p&gt;&lt;input type="text" id="nickName" placeholder="nickName" /&gt;&lt;/p&gt;
       &lt;p&gt;&lt;input type="text" id="avatar" placeholder="avatar" /&gt;&lt;/p&gt;
       &lt;p&gt;&lt;input type="text" id="platform" placeholder="platform" /&gt;&lt;/p&gt;
       &lt;p&gt;&lt;input type="text" id="messageType" placeholder="TEXT/FILE/IMAGE" value="TEXT" /&gt;&lt;/p&gt;
       &lt;p&gt;&lt;input type="number" value="1" id="showIndex" placeholder="showIndex" /&gt;&lt;/p&gt;
       &lt;p&gt;&lt;button type="button" id="addButton"&gt;提交&lt;/button&gt;&lt;/p&gt;
    &lt;div&gt;结果：&lt;span id="result"&gt;&lt;/span&gt;&lt;/div&gt;
    &lt;script&gt;
        oauthapp.allReady().then(function () {
            document.getElementById('addButton').onclick = function () 
            {
                var table = $('#table').val();
                var dataId = $('#dataId').val();
                var category = $('#category').val();
                var tags = $('#tags').val();
                var content = $('#content').val();
                var remark = $('#remark').val();
                var unionID = $('#unionID').val()||oauthapp.appUser.unionID;
                var nickName = $('#nickName').val()||oauthapp.appUser.nickName;
                var avatar = $('#avatar').val()||oauthapp.appUser.avatar;
                var platform = $('#platform').val() ||oauthapp.appUser.platform;
                var messageType = $('#messageType').val();
                var showIndex = $('#showIndex').val();

                oauthapp.messagePut(table,dataId,{
                    category,
                    tags,
                    content,
                    remark,
                    unionID,
                    nickName,
                    avatar,
                    platform,
                    messageType,
                    showIndex
                }).then(function (res) {
                    $('#result').text(JSON.stringify(res));
                });
            }
        });
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
```
</code></pre></div></div>

<p>=== “参数说明”</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>| 参数  | 说明 |  |
| ----------- | ----------- | ----------- |
| table | 字符串，必填项，表示消息所在的表名。  |  |
| id |  字符串，必填项，表示待修改消息的 ID。  |  |
| msgData.category | 字符串，选填项，表示消息分类。  |  |
| msgData.tags | 字符串数组，选填项，表示消息标签。  |  |
| msgData.content |  字符串，必填项，表示消息内容。  |  |
| msgData.remark | 字符串，选填项，表示消息备注。 |  |
| msgData.unionID | 字符串，必填项，表示第三方平台的用户 ID。 | 可以使用 oauthapp.settings.fingerIdentity 表示当前用户的 ID。 |
| msgData.nickName | 字符串，必填项，表示用户昵称。 |  |
| msgData.avatar | 用户头像 |  |
| msgData.platform | 第三方平台标识字符串 | 可以是 web、weibo、weixin、qq 或者自定义。 |
| msgData.messageType | 消息类型  | 可以是 TEXT、IMAGE、FILE 或者自定义 |
| msgData.showIndex | 排序  |  |
</code></pre></div></div>

<p><a href="https://web.oauthapp.com/4/examples/apidemo/messagePut.html">演示</a>{ .md-button }   <a href="https://docs.oauthapp.com/coding_sdk_chatmessage_messageput/">教程</a>{ .md-button }</p>

<h3 id="删除消息">删除消息</h3>

<p>oauthapp.messageDelete</p>

<p>删除指定消息表中的一条消息。需要提供需要删除的消息的ID。</p>

<p>???+ note “提示”
    该方法将返回一个 Promise，其中包含更新成功或失败的信息</p>

<p>=== “方法”</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```JavaScript linenums="1"
oauthapp.messageDelete(table,id).then(function(res){
    console.log(res);
});
```
</code></pre></div></div>

<p>=== “示例”</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```HTML linenums="1"
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;messageDelete&lt;/title&gt;
    &lt;!-- data-appid 属性替换为你的 OAuthApp 应用的 ID --&gt;
    &lt;script id="appcore" src="https://www.oauthapp.com/lib/sdk/oauthapp.1.9.8.js" data-appid="2"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div&gt;
        &lt;input type="text" id="table" placeholder="table" /&gt;
        &lt;input type="number" id="dataId" placeholder="id" /&gt;
        &lt;button type="button" id="deleteButton"&gt;删除&lt;/button&gt;
    &lt;/div&gt;
    &lt;p&gt;结果：&lt;span id="result"&gt;&lt;/span&gt;&lt;/p&gt;
    &lt;script&gt;
        oauthapp.allReady().then(function () {
            document.getElementById('deleteButton').onclick = function () {
                var  table = $('#table').val();
                var  dataId = $('#dataId').val();
                oauthapp.messageDelete(table,dataId).then(function (res) {
                    $('#result').text(JSON.stringify(res));
                })
            }
        });
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
```
</code></pre></div></div>

<p>=== “参数说明”</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>| 参数  | 说明 |  |
| ----------- | ----------- | ----------- |
| table | 表名称  |  |
| id | 消息ID  |  |
</code></pre></div></div>

<p><a href="https://web.oauthapp.com/4/examples/apidemo/messageDelete.html">演示</a>{ .md-button }    <a href="https://docs.oauthapp.com/coding_sdk_chatmessage_messagedelete/">教程</a>{ .md-button }</p>
